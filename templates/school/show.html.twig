{# templates/school/show.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}üè´ Schule #{{ school.id }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        #school-map { min-height: 370px; border-radius: 0 0 1rem 1rem; }
        .card-header { font-size: 1.1rem; }
        .leaflet-container { border-radius: 0 0 1rem 1rem; }
    </style>
{% endblock %}

{% block body %}
<div class="container my-5">
    <h1 class="mb-4">üè´ Schule anzeigen</h1>
    <div class="row g-4">
        <!-- Linke Spalte: Schuldaten -->
        <div class="col-md-6">
            <div class="card shadow-sm rounded-4 border-0">
                <div class="card-header bg-primary text-white rounded-top-4">
                    <h4 class="mb-0">Schuldaten</h4>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-5">Name</dt>
                        <dd class="col-sm-7">{{ school.name }}</dd>

                        <dt class="col-sm-5">Stra√üe</dt>
                        <dd class="col-sm-7">{{ school.street }} {{ school.streetNo }}</dd>

                        <dt class="col-sm-5">PLZ / Ort</dt>
                        <dd class="col-sm-7">{{ school.zip }} {{ school.city }}</dd>

                        <dt class="col-sm-5">Stadtteil</dt>
                        <dd class="col-sm-7">{{ school.district }}</dd>

                        <dt class="col-sm-5">Telefon</dt>
                        <dd class="col-sm-7">{{ school.phone }}</dd>

                        <dt class="col-sm-5">E-Mail</dt>
                        <dd class="col-sm-7">
                            {% if school.email %}
                                <a href="mailto:{{ school.email }}">{{ school.email }}</a>
                            {% else %}
                                &ndash;
                            {% endif %}
                        </dd>

                        <dt class="col-sm-5">Kontaktperson</dt>
                        <dd class="col-sm-7">
                            {% if school.contactPerson %}
                                {% if school.contactPerson.fullName is defined %}
                                    {{ school.contactPerson.fullName }}
                                {% else %}
                                    {{ school.contactPerson.firstName ~ ' ' ~ school.contactPerson.lastName }}
                                {% endif %}
                            {% else %}
                                &ndash;
                            {% endif %}
                        </dd>

                        <dt class="col-sm-5">Shorttag</dt>
                        <dd class="col-sm-7">{{ school.shorttag }}</dd>

                        <dt class="col-sm-5">Latitude</dt>
                        <dd class="col-sm-7">{{ school.latitude }}</dd>

                        <dt class="col-sm-5">Longitude</dt>
                        <dd class="col-sm-7">{{ school.longitude }}</dd>

                        <dt class="col-sm-5">Zusatzinfo</dt>
                        <dd class="col-sm-7">{{ school.additionalInfo ?: '&ndash;' }}</dd>
                    </dl>
                </div>
                <div class="card-footer text-end bg-light rounded-bottom-4">
                    <a href="{{ path('app_school_edit', {'id': school.id}) }}" class="btn btn-warning">‚úèÔ∏è Bearbeiten</a>
                    <a href="{{ path('app_school_index') }}" class="btn btn-secondary ms-2">‚¨ÖÔ∏è Zur√ºck</a>
                </div>
            </div>
        </div>

        <!-- Rechte Spalte: Karte -->
        <div class="col-md-6">
    <div class="card shadow-sm rounded-4 border-0">
        <div class="card-header bg-primary text-white rounded-top-4">
            <h4 class="mb-0">üìç Standort</h4>
        </div>
        <div class="card-body p-0">
            <div id="school-map" style="min-height: 400px; min-width: 100%;"></div>
        </div>
    </div>
</div>


        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    {% if school.latitude and school.longitude %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var lat = {{ school.latitude|replace({',':'.'}) }};
            var lon = {{ school.longitude|replace({',':'.'}) }};
            var map = L.map('school-map').setView([lat, lon], 16);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '¬© OpenStreetMap'
            }).addTo(map);

            L.marker([lat, lon])
                .addTo(map)
                .bindPopup('{{ school.name|e('js') }}')
                .openPopup();
        });
    </script>
    {% endif %}
{% endblock %}
