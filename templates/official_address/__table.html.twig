{% import _self as self %}

{% macro sort_link(label, field, sort, dir) %}
    {% set flip = dir == 'asc' ? 'desc' : 'asc' %}
    <a href="#" class="sort-link" data-sort="{{ field }}" data-direction="{{ field == sort ? flip : 'asc' }}">
        {{ label }}
        {% if sort == field %}
            <i class="bi bi-caret-{{ dir == 'asc' ? 'up' : 'down' }}-fill"></i>
        {% endif %}
    </a>
{% endmacro %}

<div id="address-table-container">
    <table class="table table-striped table-hover table-sm align-middle">
        <thead class="table-light">
            <tr>
                {% set sort = app.request.get('sort') %}
                {% set dir = app.request.get('direction', 'asc') %}
                <th>{{ self.sort_link('PLZ', 'postcode', sort, dir) }}</th>
                <th>{{ self.sort_link('Stadt', 'city', sort, dir) }}</th>
                <th>{{ self.sort_link('Bezirk', 'district', sort, dir) }}</th>
                <th>{{ self.sort_link('Unterbezirk', 'subdistrict', sort, dir) }}</th>
                <th>{{ self.sort_link('Nachbarschaft', 'neighbourhood', sort, dir) }}</th>
                <th>{{ self.sort_link('Stra√üe', 'street', sort, dir) }}</th>
                <th>{{ self.sort_link('Nr.', 'houseNumber', sort, dir) }}</th>
                <th>Lat</th>
                <th>Lon</th>
                <th>üìù Kommentar</th>
                <th>Quelle</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody>
            {% for a in pagination.getCurrentPageResults() %}
                <tr>
                    <td>{{ a.postcode }}</td>
                    <td>{{ a.city }}</td>
                    <td>{{ a.district ?? '‚Äì' }}</td>
                    <td>{{ a.subdistrict ?? '‚Äì' }}</td>
                    <td>{{ a.neighbourhood ?? '‚Äì' }}</td>
                    <td>{{ a.street }}</td>
                    <td>{{ a.houseNumber ?? '‚Äì' }}</td>
                    <td>{{ a.lat ?? '‚Äì' }}</td>
                    <td>{{ a.lon ?? '‚Äì' }}</td>
                    <td>{{ a.locationComment ?? '‚Äì' }}</td>
                    <td>{{ a.source ?? '‚Äì' }}</td>
                    <td class="text-nowrap">
                        <a href="{{ path('app_official_address_show', {id: a.id}) }}" class="btn btn-sm btn-outline-secondary">Anzeigen</a>
                        <a href="{{ path('app_official_address_edit', {id: a.id}) }}" class="btn btn-sm btn-outline-primary">Bearbeiten</a>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="12" class="text-center text-muted">Keine Eintr√§ge gefunden.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="d-flex justify-content-center mt-3">
        {{ pagerfanta(pagination, 'twitter_bootstrap5') }}
    </div>
</div>
