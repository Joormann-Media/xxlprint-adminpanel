{% extends 'base.html.twig' %}

{% block title %}CheatSheet Ãœbersicht{% endblock %}

{% block body %}
<div class="container py-4">
    <div class="d-flex align-items-center justify-content-between mb-4">
        <h2 class="m-0"><i class="bi bi-terminal-dash me-2"></i> CheatSheets</h2>
        <a href="{{ path('app_cheat_sheet_new') }}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Neu anlegen
        </a>
    </div>
    {% if cheat_sheets|length == 0 %}
        <div class="alert alert-warning">Noch keine Cheatsheets gefunden.</div>
    {% else %}
        <div class="row g-4">
            {% for cheat_sheet in cheat_sheets %}
                <div class="col-md-6 col-lg-4">
                    <div class="card shadow-sm h-100 border-0">
                        <div class="card-header bg-gradient bg-primary text-white py-2 d-flex align-items-center gap-2">
                            <span class="badge bg-light text-primary fw-bold">{{ cheat_sheet.category|e }}</span>
                            <span class="fw-semibold ms-2">{{ cheat_sheet.name|e }}</span>
                            <span class="ms-auto small">#{{ cheat_sheet.id }}</span>
                            <button class="btn btn-outline-primary btn-sm d-inline-flex align-items-center ms-2 cheat-toggle-btn"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#collapse-{{ cheat_sheet.id }}"
                                    aria-expanded="false"
                                    aria-controls="collapse-{{ cheat_sheet.id }}">
                                <i class="bi bi-chevron-down transition-chev" id="chevron-{{ cheat_sheet.id }}"></i>
                            </button>
                        </div>
                        <div class="collapse" id="collapse-{{ cheat_sheet.id }}">
                            <div class="card-body">
                                <!-- Name wird jetzt oben angezeigt, daher hier optional -->
                                <div class="mb-2 text-muted" style="font-size:.97em">{{ cheat_sheet.description|raw }}</div>
                                <pre class="bg-light rounded-3 p-2 mt-2 mb-0" style="font-size:.98em; overflow-x:auto; max-height:200px;">{{ cheat_sheet.content|raw }}</pre>
                            </div>
                        </div>
                        <div class="card-footer bg-light py-2 d-flex justify-content-end gap-2">
                            <a href="{{ path('app_cheat_sheet_show', {'id': cheat_sheet.id}) }}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-eye"></i> Anzeigen
                            </a>
                            <a href="{{ path('app_cheat_sheet_edit', {'id': cheat_sheet.id}) }}" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-pencil"></i> Editieren
                            </a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(function(btn) {
        const targetId = btn.getAttribute('data-bs-target');
        const icon = btn.querySelector('i');
        const collapseEl = document.querySelector(targetId);

        if (!collapseEl) return;

        collapseEl.addEventListener('show.bs.collapse', function () {
            icon.classList.remove('bi-chevron-down');
            icon.classList.add('bi-chevron-up');
        });
        collapseEl.addEventListener('hide.bs.collapse', function () {
            icon.classList.remove('bi-chevron-up');
            icon.classList.add('bi-chevron-down');
        });
    });
});
</script>
<style>
    .transition-chev {
        transition: transform .22s cubic-bezier(.4,2,.6,1);
        font-size: 1.3em;
        vertical-align: middle;
        color: #ffffff !important; /* Pfeil immer sichtbar */
    }
    .cheat-toggle-btn {
        border: none;
        background: none;
        color: #1976d2 !important;
        box-shadow: none;
        padding: 0 .2em;
    }
    .cheat-toggle-btn:focus {
        outline: none;
        box-shadow: none;
    }
    .card-header .cheat-toggle-btn:hover {
        color: #fff !important;
    }
    /* Pfeil bleibt immer sichtbar, kein color change beim Hover */
    .card-header .cheat-toggle-btn:hover .transition-chev {
        color: #fff !important;
    }
</style>
{% endblock %}
